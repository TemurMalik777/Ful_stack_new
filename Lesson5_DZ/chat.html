<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Node JS Chat</title>
        <style>
            body {
                background-color: black;
                color: greenyellow;
                font-family: monospace;
                text-align: center;
            }
            h1 {
                font-size: 2em;
            }
            #status {
                color: red;
            }
            #nickname-container,
            #chat-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                margin-top: 50px;
            }
            input {
                padding: 10px;
                font-size: 16px;
                margin: 10px 0;
                border: 1px solid greenyellow;
                background: black;
                color: greenyellow;
                outline: none;
            }
            button {
                padding: 10px 20px;
                font-size: 16px;
                background: black;
                color: greenyellow;
                border: 1px solid greenyellow;
                cursor: pointer;
            }
            #messages {
                width: 80%;
                max-width: 600px;
                text-align: left;
            }
            .message-right {
                text-align: right;
                color: cyan;
            }
            .message-left {
                text-align: left;
                color: yellow;
            }
        </style>
    </head>
    <body>
        <h1>Node JS CHAT</h1>
        <p id="status">OFFLINE</p>

        <div id="nickname-container">
            <input type="text" id="nickname" placeholder="Nick name..." />
            <button onclick="connectWebSocket()">Connect to WebSocket</button>
        </div>

        <div id="chat-container" style="display: none">
            <ul id="messages"></ul>
            <input type="text" id="input" placeholder="Type a message..." />
            <button onclick="sendMessage()">Send</button>
        </div>

        <script>
            let ws;
            let userNick = "";

            function connectWebSocket() {
                userNick = document.getElementById("nickname").value.trim();
                if (!userNick) {
                    alert("Please enter a nickname!");
                    return;
                }

                ws = new WebSocket("ws://localhost:3000");

                ws.onopen = () => {
                    document.getElementById("status").innerHTML = "CONNECTED";
                    document.getElementById(
                        "nickname-container"
                    ).style.display = "none";
                    document.getElementById("chat-container").style.display =
                        "block";

                    ws.send(
                        JSON.stringify({ type: "nickname", nickname: userNick })
                    );
                };

                ws.onmessage = (response) => {
                    const data = JSON.parse(response.data);
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>${data.nickname}:</strong> ${data.message}`;
                    li.className =
                        data.nickname === userNick
                            ? "message-right"
                            : "message-left";
                    document.getElementById("messages").appendChild(li);
                };
            }

            function sendMessage() {
                const input = document.getElementById("input");
                const message = input.value.trim();
                if (message && ws) {
                    ws.send(
                        JSON.stringify({ type: "message", message: message })
                    );
                    input.value = "";
                }
            }
        </script>
    </body>
</html>
